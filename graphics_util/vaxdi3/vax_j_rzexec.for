      SUBROUTINE J_RZEXEC(ITEMI)
C  ROUTINE TO DISPATCH TASKS FOR THE RZP3D MENU
C  (J_RZP3D IS DEVICE DEPENDENT)
C
      INCLUDE 'D0$INC:DI3INC.INC'
      COMMON/BTNCOM/VXX,VYY,IBTN
      REAL VXX,VYY
      COMMON/FONTSZ/XSZZZ,YSZZZ
      COMMON/PIXFLG/IPIX
      COMMON/RZMODS/MODWIN,UMINZ,UMAXZ,VMINZ,VMAXZ
      LOGICAL MODWIN
      COMMON/RZINIT/UPVEC0(3),UVEC0(3),VNORM0(3),VPROJ0(3),
     &  VDIST0,ANG1,ANG10,FRACT
C
C  HAVE A TASK, GO DO IT
  210 GO TO (1010,1020,1030,1040,1050,1060,1070,1080,1090,1100,
     & 1110,1120,1130,1140,1140,1140,1160,1170,1180,1190,1200)ITEMI
C  ROTATE LEFT,10
 1010 A=ANG10
 1011 CALL J_RZROT(NVEC,UVEC,A)
      CALL J_RZTRNN(VVIEW,VPROJ,VDIST)
C  ROTATE UPVEC
      CALL J_RZROTA(UPVEC,VVEC,A)
      GO TO 2000
C  ROTATE LEFT,1
 1020 A=ANG1
      GO TO 1011
C  ROTATE RIGHT,1
 1030 A=-ANG1
      GO TO 1011
C  ROTATE RIGHT,10
 1040 A=-ANG10
      GO TO 1011
C  ROTATE DOWN,10
 1050 A=ANG10
 1051 CALL J_RZROT(NVEC,VVEC,A)
      CALL J_RZTRNN(VVIEW,VPROJ,VDIST)
C  ROTATE UPVEC
      CALL J_RZROTA(UPVEC,UVEC,A)
      GO TO 2000
C  ROTATE DOWN,1
 1060 A=ANG1
      GO TO 1051
C  ROTATE UP,1
 1070 A=-ANG1
      GO TO 1051
C  ROTATE UP,10
 1080 A=-ANG10
      GO TO 1051
C  SPIN COUNTERCLOCKWISE
 1090 A=ANG10
 1091 CONTINUE
C  ROTATE UPVEC
      CALL J_RZROTA(UPVEC,NVEC,A)
      GO TO 2000
C  SPIN CLOCKWISE
 1100 A=-ANG10
      GO TO 1091
C  ZOOM(ZOOM) IN TO CURSOR WINDOW
 1110 CALL JPECHO(1,2,1,0.,0.)
      CALL JIENAB(1,2,1)
      CALL JLOCAT(1,1,0,IB1,VX1,VY1)
C  SCREEN COORDS DIRECT FROM BUTTON COMMON
      CALL J_LINE2(VD_ID,0,VXX,-100.,VXX,+100.)
      CALL J_LINE2(VD_ID,0,-100.,VYY,+100.,VYY)
      CALL JPECHO(1,2,1,VX1,VY1)
      CALL JCONVW(VX1,VY1,UMINZ,VMINZ,ZMINZ)
      CALL JIENAB(1,2,1)
      CALL JLOCAT(1,1,0,IB1,VX2,VY2)
      CALL JPECHO(1,2,1,VX2,VY2)
      CALL JCONVW(VX2,VY2,UMAXZ,VMAXZ,ZMAXZ)
C  SWAP MIN,MAX AS NEEDED. (4 QUADS)
      IF(UMAXZ.GT.UMINZ) GO TO 1111
      ATEM=UMINZ
      UMINZ=UMAXZ
      UMAXZ=ATEM
 1111 IF(VMAXZ.GT.VMINZ) GO TO 1112
      ATEM=VMINZ
      VMINZ=VMAXZ
      VMAXZ=ATEM
C  TELL JFRAME TO APPLY MODIFIED WINDOWS
 1112 MODWIN=.TRUE.
      GO TO 2000
C  UNZOOM/UNPAN
 1120 MODWIN=.FALSE.
      GO TO 2000
C  PAN TO NEW CENTER
 1130 CALL JPECHO(1,2,1,0.,0.)
      CALL JIENAB(1,2,1)
      CALL JLOCAT(1,1,0,IB1,VX1,VY1)
      CALL JPECHO(1,2,1,VX1,VY1)
      CALL JCONVW(VX1,VY1,XC,YC,ZC)
      IF(.NOT.MODWIN)THEN
        UMINZ=UMIN
        UMAXZ=UMAX
        VMINZ=VMIN
        VMAXZ=VMAX
      ENDIF
      XCOLD=(UMAXZ+UMINZ)/2.
      YCOLD=(VMAXZ+VMINZ)/2.
      DX=XC-XCOLD
      DY=YC-YCOLD
      UMINZ=UMINZ+DX
      UMAXZ=UMAXZ+DX
      VMINZ=VMINZ+DY
      VMAXZ=VMAXZ+DY
      MODWIN=.TRUE.
      GO TO 2000
C  SIDE VIEW (CLEARING FOR TOP AND END VIEWS)
 1140 DO 1141 I=1,3
        UVEC(I)=0.
        UPVEC(I)=0.
        NVEC(I)=0.
        VPROJ(I)=0.
 1141 CONTINUE
      MODWIN=.FALSE.
      IF(ITEMI.EQ.15) GO TO 1210
      IF(ITEMI.EQ.16) GO TO 1150
      UVEC(3)=1.
      UPVEC(2)=1.
      NVEC(1)=-1.
      VPROJ(1)=-1.
      GO TO 2000
C  TOP VIEW
 1210 UVEC(3)=1.
      UPVEC(1)=1.
      NVEC(2)=1.
      VPROJ(3)=-1.
      GO TO 2000
C  END VIEW
 1150 UVEC(1)=1.
      UPVEC(2)=1.
      NVEC(3)=1.
      VPROJ(3)=-1.
      GO TO 2000
C  PERSP/PARA
 1160 IF(IPROJ.EQ.3) THEN
          CALL JPARAL
        ELSE
          DN=VDIST
          CALL JPERSP(DN)
      ENDIF
      GO TO 2000
C  RESET TO INITIAL VIEW
 1170 CONTINUE
      DO 1211 I=1,3
        UVEC(I)=UVEC0(I)
        UPVEC(I)=UPVEC0(I)
        VPROJ(I)=VPROJ0(I)
        NVEC(I)=VNORM0(I)
 1211 CONTINUE
      VDIST=VDIST0
      CALL J_VUVECTS
      MODWIN=.FALSE.
      GO TO 2000
C  PRINT CURRENT SETTINGS
 1180 IPSETI=1
      GO TO 2010
C  HARDCOPY
 1190 GO TO 2010
C  EXIT!
 1200 CALL J_DELETE_DISPLAY(VD_IDB)
      RETURN
C
C  NEW PICTURE
 2000 CONTINUE
      IF(IPIX.EQ.1) THEN
C  PIXIE KLUGE.  DISPLAY ONLY THE ONE 3D SEGMENT.
          IVIS(I3DSEG)=1
          CALL JFRAME
        ELSE
          CALL JFRAME
      ENDIF
C
C  OUTPUT SETTINGS FOR DEBUG PURPOSES
 2010 CONTINUE
      IF(IPSETI.EQ.1)write (*,1221),ITEMI,UVEC,VVEC,NVEC,
     &  VVIEW,VPROJ,VDIST
C      IF(IPSETI.EQ.1)WRITE(10,1221)ITEMI,UVEC,VVEC,NVEC,
C     &  VVIEW,VPROJ,VDIST
C&IF LINUX
C& 1221 FORMAT(' *****RZP3D TASK:',I7,/,
C&     &  ' U:',3F6.2,/,' V:',3F6.2,/,' N:',3F6.2,/,' VIEWPOINT:',3F6.2,/,
C&     &  ' EYEPOINT :',3F6.2,/,' VDIST:',F6.2)
C&ELSE
 1221 FORMAT(' *****RZP3D TASK:',I,/,
     &  ' U:',3F,/,' V:',3F,/,' N:',3F,/,' VIEWPOINT:',3F,/,
     &  ' EYEPOINT :',3F,/,' VDIST:',F)
C&ENDIF
C      CALL J_DMPSEG(10)
C
      RETURN
C
C  ENTRY FOR PIXIE TO TELL J_RZP3D WHICH SEGMENT CONTAINS THE
C  3D DISPLAY. >>>CALL AFTER PUOPEN IN PC3DCL AND OTHER 3D ROUTINES<<<
      ENTRY J_PSVSEG
      I3DSEG=NSEGS
      IPIX=1
      DO 3000 II=1,NSMXX
        IVIS(II)=0
 3000 CONTINUE
      END
