C DEC/CMS REPLACEMENT HISTORY, Element MUFITX.FOR
C *1     7-FEB-1990 14:50:31 HEDIN "INITIAL INSERT"
C DEC/CMS REPLACEMENT HISTORY, Element MUFITX.FOR
      SUBROUTINE MUFITX(NP,MODI,MODU,PLN,WIR,XH,YH,ZH,VER1,VER2,
     A DV012,DV013,CHI4,LWIR,I110,I111,I112,I113)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCC CHANGEABLE ROUTINE TO PLAY WITH HITS ON TRACKS--NONBEND VIEW
CCC         VERNIER PADS
CCCC INPUT : NP=NUMBER OF POINTS
CCCC         MODULE OF INTEREST; IF=0 THEN IGNORE
CCCC         MODU,PLN,WIR  MODULE,PLANE AND WIRE OF HIT
CCCC         XH,YH,ZH  INCLUDES TIMEDIVISION
CC           VER1,2 -- 2 VERNIER SOLUTIONS, INCLUDES WIRE CENTER
CC  OUTPUT: DV012 3-MISS FOR VERNIER PLANES 012
CC          DV013 3-MISS FOR VERNIER PLANES 013
CC          CHI4 - QUALITY OF FIT 94-PLANE ONLY)
CCCC        LWIR  MOST PROBABLE COMBO
CCC         I*** - HITS USED FOR PLANES 0,1,2,3
CCCC  DH 12/89: setup for single module
CCCC  HTD 4/26/91 FIXED MINOR BUG
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
      IMPLICIT NONE
      INTEGER NP,I,I110,I111,I112,I113,LWIR,NH(24),NN,MODI
      INTEGER SI,MOD
      PARAMETER (SI=40)
      REAL XH(SI),YH(SI),ZH(SI),VER1(SI),VER2(SI) 
      INTEGER MODU(SI),PLN(SI),WIR(SI)
      REAL V0(2),V1(2),V2(2),V3(2),DEL,DV012,DV013,CHI4
C
CCCC   KLUGE FOR MODULE
      MOD=MODI
      IF(MODU(1).EQ.1) MOD=0
      DV012=-9999999.
      DV013=-9999999.
      CHI4=-9999999.
      DO I=1,24
        NH(I)=0
      ENDDO
CCC   FIND MOST COMMON CELL NUMBER
      DO I=1,NP
      IF(MOD.NE.0) THEN
      IF(VER1(I).GT.-1000..AND.MOD.EQ.MODU(I)) THEN
          NH(WIR(I)+1)=NH(WIR(I)+1)+1
        ENDIF
      ELSE
      IF(VER1(I).GT.-1000.) THEN
          NH(WIR(I)+1)=NH(WIR(I)+1)+1
        ENDIF
      ENDIF
      ENDDO
      LWIR=-1
      DO I=1,24
        IF(NH(I).EQ.3) LWIR=I-1
      ENDDO
      IF(LWIR.EQ.-1) THEN
        DO I=1,24
          IF(NH(I).EQ.2) LWIR=I-1
        ENDDO
      ENDIF
      IF(LWIR.EQ.-1) RETURN
      I110=0
      I111=0
      I112=0
      I113=0
      DO I=1,NP
      IF(MOD.NE.0) THEN
      IF(VER1(I).GT.-1000..AND.MOD.EQ.MODU(I)) THEN
          NN=IABS(WIR(I)-LWIR)
          IF(PLN(I).EQ.0.AND.NN.LE.1) I110=I
          IF(PLN(I).EQ.1.AND.NN.LE.1) I111=I
          IF(PLN(I).EQ.2.AND.NN.LE.1) I112=I
          IF(PLN(I).EQ.3.AND.NN.LE.1) I113=I
        ENDIF
      ELSE
      IF(VER1(I).GT.-1000.) THEN
          NN=IABS(WIR(I)-LWIR)
          IF(PLN(I).EQ.0.AND.NN.LE.1) I110=I
          IF(PLN(I).EQ.1.AND.NN.LE.1) I111=I
          IF(PLN(I).EQ.2.AND.NN.LE.1) I112=I
          IF(PLN(I).EQ.3.AND.NN.LE.1) I113=I
        ENDIF
      ENDIF
      ENDDO
C
      IF(I110*I111*I112.EQ.0.AND.I110*I111*I113.EQ.0) LWIR=-1
      IF(I110*I111*I112.NE.0) THEN
        V0(1)=VER1(I110)
        V0(2)=VER2(I110)
        V1(1)=VER1(I111)
        V1(2)=VER2(I111)
        V2(1)=VER1(I112)
        V2(2)=VER2(I112)
        CALL MVER3(V0,V1,V2,YH(I110),YH(I111),YH(I112),DEL)
        DV012=DEL 
      ENDIF
      IF(I110*I111*I113.NE.0) THEN
        V0(1)=VER1(I110)
        V0(2)=VER2(I110)
        V1(1)=VER1(I111)
        V1(2)=VER2(I111)
        V2(1)=VER1(I113)
        V2(2)=VER2(I113)
        CALL MVER3(V0,V1,V2,YH(I110),YH(I111),YH(I112),DEL)
        DV013=DEL 
      ENDIF
c      IF(I110*I111*I112*I113.NE.0) THEN    ! 4-DECK EVENT
       IF(I110.NE.0.AND.I111.NE.0.AND.I112.NE.0.AND.I113.NE.0) THEN    ! 4-DECK EVENT
        V0(1)=VER1(I110)
        V0(2)=VER2(I110)
        V1(1)=VER1(I111)
        V1(2)=VER2(I111)
        V2(1)=VER1(I112)
        V2(2)=VER2(I112)
        V3(1)=VER1(I113)
        V3(2)=VER2(I113)
        CALL MVER4(V0,V1,V2,V3,YH(I110),YH(I111),YH(I112),
     A  YH(I113),DEL)
        CHI4=DEL 
      ENDIF
      RETURN
      END
